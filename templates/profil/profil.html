{% load unicorn %}
<!DOCTYPE html>
<html>
  <head>
    <title>Kôš</title>
    <meta charset="utf-8">
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
         <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js" integrity="sha512-57oZ/vW8ANMjR/KQ6Be9v/+/h6bq9/l3f0Oc7vn6qMqyhvPd1cvKBRWWpzu0QoneImqr2SkmO4MSqU+RpHom3Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
          <!-- Boostrap -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
  <!-- Boostrap -->

      <!-- navbar závislosti -->
          {% load static %}<link rel="stylesheet" href="{% static 'navbar/style.css' %}" >
      <!-- navbar závislosti koniec-->

      {% unicorn_scripts %}

{% load static %}<link rel="stylesheet" href="{% static 'profile/style.css' %}" >
  </head>
  <body>
  {% include "navbar.html" with navbar_administracia=navbar_administracia %}

<div class="container" style="margin-top: 2%">

    <div class="row" id="user-profile">
        <div class="col-sm-3">

                        <div class="main-box clearfix">
                <h2>{{ uzivatel.username }}</h2>

                <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="profile-img img-fluid mx-auto">
                <div class="profile-label">
                    {% if uzivatel.is_superuser %}
                    <span class="tag badge badge-danger">Administrátor</span>
                    {% endif %}
                </div>


                <div class="profile-since">
                    Členom od: {{ profil.reg_date|date:'M' }} {{ profil.reg_date|date:'Y' }}
                </div>

                <div class="profile-details">
                    <ul class="fa-ul">
                        <li><i class="fa-li fa fa-truck"></i>Orders: <span>456</span></li>
                        <li><i class="fa-li fa fa-comment"></i>Posts: <span>828</span></li>
                        <li><i class="fa-li fa fa-tasks"></i>Tasks done: <span>1024</span></li>
                    </ul>
                </div>

                <div class="profile-message-btn mx-auto text-xs-center">
                    <a href="#" class="btn btn-success">
                        <i class="fa fa-envelope"></i> Poslať správu
                    </a>
                </div>
            </div>




        </div>
        <!--/col-3-->
        <div class="col-sm-9">
        {% if uzivatel.username == user.username %}
            <ul class="nav nav-tabs" id="myTab">
                <li class="nav-item"><a class="nav-link active" href="#home" data-toggle="tab">Profil</a></li>
                <li class="nav-item"><a class="nav-link" href="#messages" data-toggle="tab">Správy</a></li>
                <li class="nav-item"><a class="nav-link" href="#settings" data-toggle="tab">Nastavenia</a></li>
            </ul>
        {% endif %}
            <div class="tab-content">
                <div class="tab-pane active" id="home">
                        <br>
                    {% if profil.bio %}
                    <div>
                        Lepší výber lepšie ceny
                    </div>

                    <hr>
                    {% endif %}
                    <div class="row profile-user-info">
                        <div class="col-sm-8">


                            <div class="profile-user-details clearfix">
                                <div class="profile-user-details-label">Adresa</div>
                                <div class="profile-user-details-value">{{ profil.location }}</div>
                            </div>
                        <div class="profile-user-details clearfix">
                            <div class="profile-user-details-label">Vek</div>
                            <div class="profile-user-details-value">{{ profil.vek }}</div>
                        </div>
                        </div>
                        <div class="col-sm-4 profile-social">
                            <ul class="fa-ul">
                                {% if profil.website_url %}
                                <li><i class="fa-solid fa-link fa-fw"></i>
                                    <a href="#">Web</a></li>
                                {% endif %}
                            {% if profil.facebook_url %}
                                <li><i class="fa-brands fa-square-facebook fa-fw"></i></i>
                                    <a href="#">Facebook</a></li>
                            {% endif %}
                            {% if profil.instagram_url %}
                                <li><i class="fa-brands fa-square-instagram fa-fw"></i>
                                    <a href="#">Instagram</a></li>
                            {% endif %}
                            {% if profil.linked_in_url %}
                                <li><i class="fa-brands fa-linkedin fa-fw"></i>
                                    <a href="#">Linked in</a></li>
                            {% endif %}
                            {% if profil.youtube_url %}
                                <li><i class="fa-brands fa-square-youtube fa-fw"></i>
                                    <a href="#">Youtube</a></li>
                            {% endif %}
                            </ul>
                        </div>
                    </div>

                </div>
                <!--/tab-pane-->
                <div class="tab-pane" id="messages">

                    <h2></h2>

                    <ul class="list-group">
                        <li class="list-group-item text-muted">Notifikácie</li>
                        <li class="list-group-item text-right"><a href="#" class="pull-left">Blabla</a> 22.3.2214</li>

                    </ul>

                </div>
                <!--/tab-pane-->
                <div class="tab-pane" id="settings">
                        <br>
                    <form class="form" action="#" method="post" id="registrationForm">

                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="email">
                                    <h4>Nový email</h4></label>
                                <input type="email" class="form-control" name="email" id="email" placeholder="{{ profil.user.email }}" title="Zadajte nový email.">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="location">
                                    <h4>Nová lokalita</h4></label>
                                <input type="email" class="form-control" id="location" placeholder="{{ profil.location }}" title="Zadajte novú lokalitu">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="datum_narodenia">
                                    <h4>Nový dátum narodenia</h4></label>
                                <input type="date" class="form-control" id="datum_narodenia" value="{{ profil.birth_date|date:'Y-m-d' }}" >
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="password">
                                    <h4>Nové heslo</h4></label>
                                <input type="password" class="form-control" name="password" id="password" placeholder="nové heslo" title="Zadajte nové heslo.">
                            </div>
                        </div>
                        <div class="form-group">

                            <div class="col-xs-6">
                                <label for="password2">
                                    <h4>Nové heslo znovu</h4></label>
                                <input type="password" class="form-control" name="password2" id="password2" placeholder="nové heslo znovu" title="Zadajte nové heslo znovu.">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-12">
                                <br>
                                <button class="btn btn-lg btn-success" type="button" onclick="uloz_nastavenia()"><i class="glyphicon glyphicon-ok-sign"></i>Uložiť</button>
                                <button class="btn btn-lg btn-danger" type="reset"><i class="glyphicon glyphicon-repeat"></i>Resetovať</button>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
            <!--/tab-pane-->
        </div>
        <!--/tab-content-->

    </div>
    <!--/col-9-->
</div>
<!--/row-->

<script>

async function uloz_nastavenia() {
            if(document.getElementById('email').value ==='' && document.getElementById('location').value ===''
            && document.getElementById('datum_narodenia').value ==='{{ profil.birth_date|date:'Y-m-d' }}'
            && document.getElementById('password').value ==='' && document.getElementById('password2').value ===''){
                return true;
            }
            if (document.getElementById('password').value!==document.getElementById('password2').value){
                alert("Nové heslo a overenie nového hesla sa nezhoduje. Skúste prosím znovu.");
                return true;
            }

          let user = {
          email: document.getElementById('email').value,
          location: document.getElementById('location').value,
          datum_narodenia: document.getElementById('datum_narodenia').value,
          password: document.getElementById('password').value,
          password2: document.getElementById('password2').value,
          uzivatel_nastavenia_ulozit: null,
        };

        let response = await fetch('/api', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json;charset=utf-8'
          },
          body: JSON.stringify(user)
        });

        if (response.ok && response.status === 201){
            alert("Profil úspešne aktualizovaný !");
            location.reload();
        }
        else if (response.status === 301) {
            response.json().then(data => {
                let json = JSON.parse(JSON.stringify(data));
                let vystup = "Zmeny neboli uložené z nasledujúcich dôvodov: ";
                for (var key in json) {
                    if (json.hasOwnProperty(key)) {
                      vystup = vystup + "\n" + json[key];
                    }
                }
                alert(vystup);
            });
        }
        else {
            alert("Niekde nastala chyba. Skúste znovu");
        }
        return true;
}

</script>
  </body>
</html>